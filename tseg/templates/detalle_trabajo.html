{% extends "layout.html" %}
{% block content %}
    <h6 class="border-bottom border-secondary mb-4">Detalle Orden de Trabajo</h6>
    <article class="media content-section">
        
        <div class="media-body">
            <div class="row align-items-center">
                <div class="col-md-11">
                    <div class="article-metadata">                        
                  		<small title="Fecha creación" class="text-muted">{{ detalle_trabajo.date_created.strftime('%Y-%m-%d') }}</small></p>             
                    </div>
                </div>
                <div class="col-md-1">
                    <button class="btn btn-outline-light bi-arrow-return-left" onclick="goBack()" title="Volver atrás"></button>
                </div>
            </div>
            
            <div class="row align-items-center">
                <div class="col-md-3 text-end">
                    <small>Detalle O.T.:</small> 
                </div>
                <div class="col-md-9">
                    <h5 class="aticle-title">{{ detalle_trabajo.content }}</h5>
                </div>
            </div>

            <div class="row align-items-center">
                <div class="col-md-3 text-end">
                    <small>Cantidad:</small> 
                </div>
                <div class="col-md-9">
                    <small class="article-title"><b>{{ detalle_trabajo.cantidad }}</b></small>
                </div>
            </div>

            <div class="row align-items-center">
                <div class="col-md-3 text-end">
                    <small>Usuario:</small> 
                </div>
                <div class="col-md-9">
                    <small class="article-title"><b>{{ detalle_trabajo.author_detalle_trabajo }}</b></small>
                </div>
            </div>
            
            <div class="row align-items-center">
                <div class="col-md-3 text-end">
                    <small>Orden de trabajo:</small> 
                </div>
                <div class="col-md-9">
                    <a class="article-title" style="background-color: 
                    {% if detalle_trabajo.orden_trabajo.estado.descripcion == 'Producción' %}orange
                    {% elif detalle_trabajo.orden_trabajo.estado.descripcion == 'Entregada' %}lightgreen
                    {% elif detalle_trabajo.orden_trabajo.estado.descripcion == 'Terminada' %}aqua
                    {% elif detalle_trabajo.orden_trabajo.estado.descripcion == 'Cancelada' %}darkgrey
                    {% endif %}",
                    href="{{ url_for('ordenes_trabajo.orden_trabajo', orden_trabajo_id=detalle_trabajo.orden_trabajo.id) }}">
                    <b>{{ detalle_trabajo.orden_trabajo }}</b></a>
                </div>
            </div>

            <div class="row align-items-center">
                <div class="col-md-3 text-end">
                    <small>Última modificación: </small>
                </div>
                <div class="col-md-9">
                    <small class="article-title"><b>{{ detalle_trabajo.date_modified }}</b></small>
                </div>
            </div>
            
            

        </div>  
        
            <div>
                <a class="bi bi-plus-square btn btn-outline-info" title="Añadir Equipo" href="{{ url_for('equipments.add_equipment', detalle_trabajo_id=detalle_trabajo.id) }}"></a>
                <a  class="bi bi-pencil-fill btn btn-outline-warning" title="Editar detalle de trabajo" href="{{ url_for('detalles_trabajo.update_detalle_trabajo', detalle_trabajo_id=detalle_trabajo.id) }}"></a>
                <a class="bi bi-trash-fill btn btn-outline-danger" href="#" data-toggle="modal" data-target="#deleteModal" title="Eliminar detalle_trabajo"></a>
            </div>
        
    </article>

        
    {% for equipment in lista %}
        <article class="media content-section-list">
            <div class="media-body">
                <div class="row">                    
                    <div class="col-md-3"> 
                        <div class="img-container">
                            <a href="#" onclick="abrirImagen('{{ image_path+equipment.modelo.image_file }}'); return false;">
                                <img class="rounded-3 account-img" src="{{ image_path+equipment.modelo.image_file }}" alt="Imagen" />
                                <div class="overlay">
                                    <div class="overlay-content">Abrir Imagen</div>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-8">
                    <a class="article-title" href="{{ url_for('equipments.equipment', equipment_id=equipment.id) }}">
                        <h2>{{ equipment.modelo }}</h2>
                        <h6 class="article-title" href=""><b>{{ equipment.frecuencia_eq.canal }} {{ equipment.frecuencia_eq.rango }} </b>
                            - Nº serie: <b>{{ equipment.detalle_trabajo.orden_trabajo.codigo }}-{{ equipment.numSerie }}</b></h6>
                        <small>
                            Cliente: <b>{{ equipment.detalle_trabajo.orden_trabajo.client.nombre }} {{ equipment.detalle_trabajo.orden_trabajo.client.apellido }}</b> - Año fabricación: <b>{{ equipment.anio }}</b>
                            <h6 class="article-title">Última modificación: <b>{{ equipment.date_modified.strftime('%d-%m-%Y') }}</b></h6>
                        </small>
                        </a>
                    </div>
                    <div class="col-md-1">
                        <a class="bi bi-chat btn btn-outline-light" title="Añadir Historia" href="{{ url_for('historias.add_historia', equipment_id = equipment.id) }}"></a>
                    </div>
                </div> 
            </div>
        </article>
    {% endfor %}

     <!-- Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">¿Seguro desea borrarlo?</h5>
            <button type="button" class="Cerrar" data-dismiss="modal" aria-label="Cerrar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            <form action="{{ url_for('detalles_trabajo.delete_detalle_trabajo', detalle_trabajo_id=detalle_trabajo.id) }}" method="POST">
              <input class="btn btn-danger" type="submit" value="Borrar">
            </form>
          </div>
        </div>
      </div>
    </div>
{% endblock content %}