<!-- TSEG - Programa de seguimiento de equipos LIECOM -->
<!DOCTYPE html>

<html>
	<head>
		<meta content="initial-scale=1, width=device-width" name="viewport">
		<meta charset="utf-8">
		<link rel="icon" href="{{ url_for('static', filename='images/tecseg_icon.png') }}">

		<!-- Bootstrap CSS -->
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
	    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

	    
	    <!-- Bootstrap ICONS online -->
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

	    <!-- CSS Libreria CHOSEN - SELECT user friendly -->
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/chosen.css') }}">
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/jquery.css') }}">

	    <!-- CSS general. !usa el metodo de flask para ubicar el archivo -->
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">

	    <!-- JS Bootstrap primero sino chosen no funciona-->	
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>	
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

		<!-- JS para SELECT CHOSEN autocompletar -->
		<script src="{{ url_for('static', filename='js/jquery_jquery.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/jqueryui_jquery-ui.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/chosen_chosen.jquery.js') }}"></script>
	    
	    <!-- JS de funciones generales  -->
		<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
		
		<!-- título por defecto, o toma uno 'title' -->
		{% if title %}
			<title>{{ title }}</title>
		{% else %}
			<title>TECSEG</title>
		{% endif %}
	</head>

	<body >	
		<header class="site-header">
			<nav>			
				<ul class="menu-horizontal">
					<a class="navbar-brand" href="/index"><img src="./static/images/LOGO.png" width="75" height="75"></a>
					<!-- SOLO REGISTRADOS -->
					{% if current_user.is_authenticated %}
						<!-- SOLO admin -->
						{% if current_user.role.role_name == "Admin" %}
							<li>
								<a class="menu-horizontal">Admin</a>
								<ul class="menu-vertical">
									<li><a class="nav-item nav-link" href="{{ url_for('users.register') }}" class="list-group-item list-group-item-light">Registrar Usuario</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('users.all_users', filterBy='username', filterOrder='asc') }}" class="list-group-item list-group-item-light">Ver cuentas de usuarios</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('equipments.reporte_zona') }}" class="list-group-item list-group-item-light">Reporte equipos por zona</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('ordenes_reparacion.reporte_tecnico') }}" class="list-group-item list-group-item-light">Reporte OR por técnico</a></li>
								</ul>
							</li>
						{% endif %}
						<!-- SECTOR TODOS menos INVITADOS -->
						{% if current_user.role.role_name != "Invitado" %}
							<li>
								<a class="menu-horizontal">Clientes</a>
								<ul class="menu-vertical">
									<li><a class="nav-item nav-link" href="{{ url_for('clients.add_client') }}" class="list-group-item list-group-item-light">Registrar Cliente</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('clients.all_clients', filterBy='id', filterOrder='asc') }}">Ver todos</a></li>	
								</ul>
							</li>
						
							<li>
								<a class="menu-horizontal">Equipos</a>
								<ul class="menu-vertical">
									<li><a class="nav-item nav-link" href="{{ url_for('equipments.add_equipment', client_id=0) }}" class="list-group-item list-group-item-light">Agregar Equipo</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('equipments.all_equipments', filterBy='anio', filterOrder='desc') }}">Ver todos</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('modelos.add_modelo') }}" class="list-group-item list-group-item-light">Agregar Modelo</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('modelos.all_modelos', filterBy='date_modified', filterOrder='desc') }}" class="list-group-item list-group-item-light">Ver Modelos</a></li>
									<li><a class="nav-item nav-link" href="{{ url_for('users.user_historias', username=current_user.username) }}" class="list-group-item list-group-item-light">Mis historias</a></li>
								</ul>
							</li>						
						
							<li>
								<a class="menu-horizontal" title="Órdenes de reparación">O.R.</a>
								<ul class="menu-vertical">
									<li><a class="nav-item nav-link" href="{{ url_for('ordenes_reparacion.add_orden_reparacion', equipment_id=0) }}" class="list-group-item list-group-item-light">Crear O.R.</a></li>
									<li><a class="nav-item nav-link"  href="{{ url_for('ordenes_reparacion.all_ordenes_reparacion', filterBy='estado_id', filterOrder='asc') }}">Ver todas</a></li>
								</ul>
							</li>
						{% endif %}
						<!-- SECTOR PARA TODOS LOS USUARIOS -->
						<li>
							<a title="Ir a mi cuenta"  href="{{ url_for('users.account', user_id=current_user.id) }}"><img class="rounded-circle nav-img" src="{{ url_for('static', filename='profile_pics/' + 	current_user.image_file) }}"></a>
							<ul class="menu-vertical">
								<li><a class="nav-item nav-link" href="{{ url_for('users.logout') }}">Cerrar sesión</a></li>
							</ul>
						</li>	
					{% else %}
						<li><a class="nav-item nav-link" href="{{ url_for('users.login') }}">Iniciar sesión</a></li>
		      		{% endif %}		      
			        <li class="text-end">
			        	<img src="{{ url_for('static', filename='images/theme_dark.png') }}" id="icon" title="Cambiar tema">
			        </li>
				</ul>
			</nav>
	  	</header>

	    <main role="main" class="container">
	      	<div class="row">
	        	<div class="col-md-8">
		          	{% with messages = get_flashed_messages(with_categories=true) %}
			            {% if messages %}
			            	{% for category, message in messages %}
			                <div class="alert alert-{{ category }}">
			                	{{ message }}
			                </div>
			              	{% endfor %}
			            {% endif %}
		          	{% endwith %}
		          	{% block content %}		          	
		          	{% endblock %}		          	
	        	</div>
	        	<!-- BUSCADOR-->
		        <div class="col-md-4">
		        	<div class="sticky-top">
	        			{% if current_user.is_authenticated %}
	        				<article class="media content-section">
		          				<form class="d-flex ms-auto" method="POST" action="{{ url_for('users.search') }}">
									{{ form.hidden_tag() }}
									<div class="input-group mb-3">
										<input class="form-control" type="search" aria-label="Search" placeholder="Buscar..." name="searched">
										<div class="input-group-append">
											<button class="btn btn-secondary" type="submit"><i class="bi bi-search"></i></button>
										</div>
									</div>
								</form>
	      					</article>
	          			{% endif %}
	          			{% if lista %}
	          			<article class="media content-section">
	          				<h5 class="border-bottom border-secondary mb-4">Ordenar lista {{ title }}</h5>
		          			<div class="row">
		          				<div class="col-md-8">
								    <select class="form-select" aria-label="Filter by column" id="filterBy">
								        {% for key, value in filtrar_por.items() %}
								            <option value="{{ key }}" {% if request.args.get('filterBy') == key %}selected{% endif %}>{{ value }}</option>
								        {% endfor %}
								    </select>
								    <select class="form-select" aria-label="Filter order" id="filterOrder">
								        <option value="asc" {% if request.args.get('filterOrder') == 'asc' %}selected{% endif %}>Ascendente</option>
        								<option value="desc" {% if request.args.get('filterOrder') == 'desc' %}selected{% endif %}>Descendente</option>
								    </select>
								    <button class="btn btn-primary" id="filterButton">Ordenar</button>
								</div>
						  	</div>
						</article>
						{% endif %}	          				
		         	</div>
	        	</div>
	      	</div>
	    </main>
	    <br>
		<footer id="footer" class="footer">
			<div class="copyright">
				&copy; TECSEG 2023 | <strong>Agustín Arnaiz</strong>
			</div>
		</footer>
	</body>
	<script type="text/javascript">
		
	  	// THEME COLOR CHANGER
	    window.addEventListener("DOMContentLoaded", function() {
		    var icon = document.getElementById("icon");
	    	var body = document.body;

	    	// Recuperar el estado del tema del almacenamiento local
	    	var theme = localStorage.getItem("theme");
		    	if (theme === "light") {
				body.classList.add("theme-light");
	      	}

	    	icon.onclick = function() {
	        	body.classList.toggle("theme-light");
	        	document.body.style.transition = '2s';
		        if(document.body.classList.contains("theme-light")){
		        	icon.src = "{{ url_for('static', filename='images/theme_light.png') }}";
		        	icon.title = "Cambiar a modo oscuro";
		        }else{
		        	icon.src = "{{ url_for('static', filename='images/theme_dark.png') }}";
		        	icon.title = "Cambiar a modo claro";
	        	}

	        	// Guardar el estado del tema en el almacenamiento local
	        	if (body.classList.contains("theme-light")) {
	        		localStorage.setItem("theme", "light");
	        	} 
	        	else{
	        		localStorage.setItem("theme", "dark");
	        	}
	    	};
	    });

	    // THEME COLOR CALL
	    function cambiarColor() {
			  var selectElement = document.getElementById("estadoSelect");
			  var selectedOption = selectElement.options[selectElement.selectedIndex];
			  selectElement.className = selectedOption.className + " selected";
			}
	 
	 	// convierte un SELECT a CHOSEN
	  	$(".chosen").chosen({
			    search_contains: true,
			    no_results_text: 'No se encontró: ',
			    width: '100%',
			    max_shown_results: 100,  
			  });

	  	// Pone en la barra de navegacion los valores de filterBy y filterOrder
		document.getElementById('filterButton').addEventListener('click', function() {
			var filterBy = document.getElementById('filterBy').value;
	        var filterOrder = document.getElementById('filterOrder').value;
	        var url = new URL(window.location.href);
	        url.searchParams.set('filterBy', filterBy);
	        url.searchParams.set('filterOrder', filterOrder);
	        window.location.href = url;
		});
		</script>
</html>